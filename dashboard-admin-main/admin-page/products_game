<!-- ======================================================= -->
<!--                 GAME PRODUCTS SECTION                   -->
<!-- ======================================================= -->

<div class="form-container">
    <h2><?= isset($_GET['edit_game']) ? 'Edit Produk Game' : 'Tambah Produk Game Baru' ?></h2>
    <form method="POST" action="">
        <?php
        if (isset($_GET['edit_game'])) {
            $edit_game_id = intval($_GET['edit_game']);
            $edit_game = $conn->query("SELECT * FROM gameproducts WHERE product_id=$edit_game_id")->fetch_assoc();
        }
        ?>
        <input type="hidden" name="action" value="<?= isset($_GET['edit_game']) ? 'edit_game' : 'add_game' ?>">
        <?php if (isset($_GET['edit_game'])): ?>
            <input type="hidden" name="product_id" value="<?= $edit_game['product_id'] ?>">
        <?php endif; ?>

        <label for="game_name">Nama Game:</label>
        <input id="game_name" type="text" name="game_name" required value="<?= htmlspecialchars($edit_game['game_name'] ?? '') ?>" placeholder="Contoh: Mobile Legends">

        <label for="product_code">Kode Produk:</label>
        <input id="product_code" type="text" name="product_code" required value="<?= htmlspecialchars($edit_game['product_code'] ?? '') ?>" placeholder="Contoh: ML001">

        <label for="description">Deskripsi:</label>
        <input id="description" type="text" name="description" value="<?= htmlspecialchars($edit_game['description'] ?? '') ?>" placeholder="Deskripsi singkat produk">

        <label for="price">Harga:</label>
        <input id="price" type="number" step="0.01" name="price" required value="<?= htmlspecialchars($edit_game['price'] ?? '') ?>" placeholder="Contoh: 15000.00">

        <label for="currency">Mata Uang:</label>
        <input id="currency" type="text" name="currency" required value="<?= htmlspecialchars($edit_game['currency'] ?? 'IDR') ?>" placeholder="Contoh: IDR">

        <label for="available">Status:</label>
        <select id="available" name="available">
            <option value="1" <?= (isset($edit_game['available']) && $edit_game['available']==1) ? 'selected' : '' ?>>Tersedia</option>
            <option value="0" <?= (isset($edit_game['available']) && $edit_game['available']==0) ? 'selected' : '' ?>>Tidak Tersedia</option>
        </select>

        <button type="submit"><?= isset($_GET['edit_game']) ? 'Perbarui Produk' : 'Simpan Produk' ?></button>
        <?php if (!isset($_GET['edit_game'])): ?>
            <a href="?reset_games=true" onclick="return confirm('⚠️ Yakin ingin hapus SEMUA produk dan reset ID ke 1?')" class="reset-btn">Reset Semua Produk</a>
        <?php endif; ?>
    </form>
</div>

<div class="table-container">
    <h2>Daftar Produk Game</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Nama Game</th>
            <th>Kode Produk</th>
            <th>Deskripsi</th>
            <th>Harga</th>
            <th>Mata Uang</th>
            <th>Status</th>
            <th>Tanggal Buat</th>
            <th>Aksi</th>
        </tr>

        <?php
        $result_games = $conn->query("SELECT * FROM gameproducts ORDER BY product_id DESC");
        if ($result_games && $result_games->num_rows > 0) {
            while ($row = $result_games->fetch_assoc()) {
                echo "<tr>
                        <td>{$row['product_id']}</td>
                        <td>" . htmlspecialchars($row['game_name']) . "</td>
                        <td>" . htmlspecialchars($row['product_code']) . "</td>
                        <td>" . htmlspecialchars($row['description']) . "</td>
                        <td>" . number_format($row['price'], 2) . "</td>
                        <td>{$row['currency']}</td>
                        <td>" . ($row['available'] ? '✅' : '❌') . "</td>
                        <td>{$row['created_at']}</td>
                        <td>
                            <a href='?edit_game={$row['product_id']}' class='edit-btn'>Edit</a>
                            <a href='?delete_game={$row['product_id']}' onclick=\"return confirm('Hapus produk ini?');\" class='delete-btn'>Delete</a>
                        </td>
                      </tr>";
            }
        } else {
            echo "<tr><td colspan='9' style='text-align:center;'>Belum ada produk game terdaftar.</td></tr>";
        }
        ?>
    </table>
</div>
